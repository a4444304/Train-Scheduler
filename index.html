<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="UTF-8">
  <title>Train Scheduler</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="styles.css">
  <!-- Added Moment JS -->
  <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
           
</head>

<body>

  <div class="container">

    <br>

    <!-- Jumbotron -->
    <div class="jumbotron">
      <h1 class="text-center">Penn Station Train Schedule</h1>
    </div>
    <div class="row">
    
    <script>
              
                        
    // Assumptions
    var trainFrequency = 3;
            
    // Time is 3:30 AM
    var firstTime = "03:30";
            
    // First Time (pushed back 1 year to make sure it comes before current time)
    var firstTimeConverted = moment(firstTime, "HH:mm").subtract(1, "years");
        console.log(firstTimeConverted);
            
    // Current Time
    var currentTime = moment();
        console.log("CURRENT TIME: " + moment(currentTime).format("hh:mm"));
            
    // Difference between the times
    var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
        console.log("DIFFERENCE IN TIME: " + diffTime);
            
    // Time apart (remainder)
    var tRemainder = diffTime % trainFrequency;
        console.log(tRemainder);
            
    // Minute Until Train
    var tMinutesTillTrain = trainFrequency - tRemainder;
        console.log("MINUTES TILL TRAIN: " + tMinutesTillTrain);
            
    // Next Train
    var nextTrain = moment().add(tMinutesTillTrain, "minutes");
        console.log("ARRIVAL TIME: " + moment(nextTrain).format("hh:mm"));
    </script>
            
     <!-- Train Information Card-->
      <div class="col-lg-12">
        <div class="card card-default">
          <div class="card-header">
           Add Train
          </div>
          <div class="card-body">

            <!-- Train Information Form-->
            <form role="form">
              <div class="form-group row">
                <label for="train-name-input">Train Name:</label>
                <input class="form-control" id="train-name-input" type="text">
              </div>
              <div class="form-group row">
                <label for="destination-input">Destination:</label>
                <input class="form-control" id="destination-input" type="text">
              </div>
              <div class="form-group row">
                <label for="first-train-time-input">First Train Time (military time)</label>
                <input class="form-control" id="first-train-time-input" type="number">
              </div>
              <div class="form-group row">
                <label for="frequency-input">Frequency (min)</label>
                <input class="form-control" id="frequency-input" type="number">
              </div>
              <button class="btn btn-default" id="add-user" type="submit">Submit</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery.js"></script>

  <!-- LINKS FOR FIREBASE-->
  <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-database.js"></script>

  <!-- Script -->
  <script>
     // Initialize Firebase
    var config = {
      apiKey: "AIzaSyA5eYKsB8T2q6rMGdKSvac6eQsWTzsZEjE",
      authDomain: "fir-recent-user.firebaseapp.com",
      databaseURL: "https://fir-recent-user.firebaseio.com",
      storageBucket: "fir-recent-user.appspot.com"
    };

    firebase.initializeApp(config);

    // Create a variable to reference the database
    var database = firebase.database();

    // Initial Values
    var trainName = "";
    var trainDestination = "";
    var firstTrainTime = 0;
    var frequency = 0;

    // Capture Button Click
    $("#train-name-input").on("click", function(event) {
      // Don't refresh the page!
      event.preventDefault();

      // Code in the logic for storing and retrieving the most recent user.
      // Don't forget to provide initial data to your Firebase database.
      trainName = $("#train-name-input").val().trim();
      trainDestination = $("#destination-input").val().trim();
      firstTrainTime = $("#first-train-time-input").val().trim();
      frequency = $("#frequency-input").val().trim();

      database.ref().set({
        trainName: name,
        trainDestination: destination,
        firstTrainTime: time,
        frequency: frequency
      });

    });

    // Firebase watcher + initial loader HINT: .on("value")
    database.ref().on("value", function(snapshot) {

      // Log everything that's coming out of snapshot
      console.log(snapshot.val());
      console.log(snapshot.val().name);
      console.log(snapshot.val().email);
      console.log(snapshot.val().age);
      console.log(snapshot.val().comment);

      // Change the HTML to reflect
      $("#name-display").text(snapshot.val().name);
      $("#email-display").text(snapshot.val().email);
      $("#age-display").text(snapshot.val().age);
      $("#comment-display").text(snapshot.val().comment);

      // Handle the errors
    }, function(errorObject) {
      console.log("Errors handled: " + errorObject.code);
    });

  </script>

</body>

</html>
